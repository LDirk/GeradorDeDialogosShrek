dialogs = [

"DONKEY Please, dont turn me in. Ill never be stubborn again. I can change. Please Give me another chance",
"DONKEY OH",
"DONKEY Hey I can fly",
"DONKEY Ha, ha Thats right, fool Now Im a flying, talking donkey. You might have seen a housefly,maybe even a superfly but I bet you aint never seen a donkey fly. Ha, ha",
"DONKEY Can I say something to you? Listen, you was really, really, really somethin back here Incredible",
"DONKEY Yes. I was talkin to you. Can I tell you that you that you was great back here? Those guards They thought they was all of that. Then you showed up, and bam They was trippin over themselves like babes in the woods. That really made me feel good to see that",
"DONKEY Man, its good to be free.",
"DONKEY But, uh, I don't have any friends. And I'm not goin' out there by myself. Hey, wait a minute! I got a great idea! I'll stick with you. You're mean, green, fightin' machine. Together we'll scare the spit out of anybody that crosses us",
"DONKEY Oh, wow! That was really scary. If you don't mind me sayin', if that don't work, your breath certainly will get the job done, 'cause you definitely need some Tic Tacs or something, 'cause you breath stinks! You almost burned the hair outta my nose, just like the time...(Shrek covers his mouth but Donkey continues to talk, so Shrek removes his hand.) ...then I ate some rotten berries. I had strong gases leaking out of my butt that day",
"DONKEY I'll tell you why. (singing) 'Cause I'm all alone, There's no one here beside me, My problems have all gone, There's no one to deride me, But you gotta have faith ", 
"DONKEY Wow. Only a true friend would be that cruelly honest",
"DONKEY really tall?",
"DONKEY Nope" ,
"DONKEY Really, really",
"DONKEY Man, I like you. What's you name?",
"DONKEY Shrek? Well, you know what I like about you, Shrek? You got that kind of I-don't-care-what-nobodythinks-of-me thing. I like that. I respect that, Shrek. You all right. (They come over a hill and you can see Shrek's cottage.) Whoa! Look at that. Who'd want to live in place like that?",
"DONKEY Oh! And it is lovely! Just beautiful. You know you are quite a decorator. It's amazing what you've done with such a modest budget. I like that boulder. That is a nice boulder. I guess you don't entertain much, do you?",
"DONKEY  You know, I do too. That's another thing we have in common. Like I hate it when you got somebody in your face. You've trying to give them a hint, and they won't leave. There's that awkward silence. (awkward silence) Can I stay with you?",
"DONKEY Can I stay with you, please?",
"DONKEY Really?",
"DONKEY Please! I don't wanna go back there! You don't know what it's like to be considered a freak. (pause while he looks at Shrek) Well, maybe you do. But that's why we gotta stick together. You gotta let me stay! Please! Please!",
"DONKEY Ah! Thank you!", 
"DONKEY This is gonna be fun! We can stay up late, swappin' manly stories, and in the mornin' I'm makin' waffle"
"DONKEY Where do, uh, I sleep?",
"DONKEY Oh, well, I guess that's cool. I mean, I don't know you, and you don't know me, so I guess outside is best, you know. Here I go. Goodnight. I mean, I do like theoutdoors. I'm a donkey. I was bornoutside. I'll just be sitting by myself outside, I guess, you know. By myself, outside. I'm all alone...there's no one here beside me",
"DONKEY I am outside",
"DONKEY Hey, don't look at me. I didn't invite them",
"DONKEY Oh, I do. I know where he is",
"DONKEY Me! Me!",
"DONKEY Oh! Oh, pick me! Oh, I know! I know! Me, me!",
"DONKEY All right, that's what I like to hear, man. Shrek and Donkey, two stalwart friends, off on a whirlwind big-city adventure. I love it!",
"DONKEY On the road again. Sing it with me, Shrek. I can't wait to get on the road again.",
"DONKEY Can I whistle?,Can I hum it?", 
"DONKEY But that's it. That's it right there. That's DuLoc. I told ya I'd find it.",
"DONKEY Uh-huh. That's the place.",
"DONKEY Hey, wait. Wait up, Shrek.",
"DONKEY Hey, look at this!", 
"DONKEY Wow! Let's do that again! (makes ready to run over and pull the lever again)",
"DONKEY Sorry about that", 
"DONKEY Hey, Shrek, tag me! Tag me!",
"DONKEY Let me get this straight. You're gonna go fight a dragon and rescue a princess just so Farquaad will give you back a swamp which you only don't have because he filled it full of freaks in the first place. Is that about right?",
"DONKEY I don't get it. Why don't you just pull some of that ogre stuff on him? Throttle him, lay siege to his fortress, grinds his bones to make your bread, the whole ogre trip.",
"DONKEY Uh, no, not really, no.",
"DONKEY Example?",
"DONKEY (sniffs the onion) They stink?,They make you cry?",
"DONKEY You leave them in the sun, they get all brown, start sproutin' little white hairs.",
"DONKEY (trailing after Shrek) Oh, you both have layers. Oh. {Sniffs} You know, not everybody likes onions. Cake! Everybody loves cakes! Cakes have layers.",
"DONKEY You know what else everybody likes? Parfaits. Have you ever met a person, you say, Let's get some parfait, they say, Hell no, I don't like no parfait Parfaits are delicious.",
"DONKEY Parfaits may be the most delicious thing on the whole damn planet."
"DONKEY Do you have a tissue or something? I'm making a mess. Just the word parfait make me start slobbering.", 
"DONKEY (sniffs) Ohh! Shrek! Did you do that? You gotta warn somebody before you just crack one off. My mouth was open and everything.",
"DONKEY Yeah, right, brimstone. Don't be talking about it's the brimstone. I know what I smell. It wasn't no brimstone. It didn't come off no stone neither.",
"DONKEY Uh, Shrek? Uh, remember when you said ogres have layers?",
"DONKEY Well, I have a bit of a confession to make. Donkeys don't have layers. We wear our fear right out there on our sleeves", 
"DONKEY You know what I mean",
"DONKEY No, I'm just a little uncomfortable about being on a rickety bridge over a boiling like of lava!",
"DONKEY Really? Okay, that makes me feel so much better.",
"DONKEY Okay, don't look down. Don't look down. Don't look down. Keep on moving. Don't look down. (he steps through a rotting board and ends up looking straight down into the lava) Shrek! I'm lookin' down! Oh, God, I can't do this! Just let me off, please!",
"DONKEY But I know that half is safe!",
"DONKEY Shrek, no! Wait! DONKEY Don't do that!",
"DONKEY Yes, that!",
"DONKEY No, Shrek! No! Stop it!",
"DONKEY I'm gonna die. I'm gonna die. Shrek, I'm gonna die. (steps onto solid ground) Oh!",
"DONKEY Cool. So where is this fire- breathing pain-in-the-neck anyway?",
"DONKEY I was talkin' about the dragon, Shrek. INSIDE THE CASTLE,You afraid?.Oh, good. Me neither. (sees a skeleton and gasps) 'Cause there's nothin' wrong with bein' afraid. Fear's a sensible response to an unfamiliar situation. Unfamiliar dangerous situation, I might add. With a dragon that breathes fire and eats knights and breathes fire, it sure doesn't mean you're a coward if you're a little scared. I sure as heck ain't no coward. I know that.",
"DONKEY Stairs? I thought we was lookin' for the princess.",
"DONKEY What makes you think she'll be there?",
"DONKEY Cool. You handle the dragon. I'll handle the stairs. I'll find those stairs. I'll whip their butt too. Those stairs won't know which way they're goin'. (walks off)",
"DONKEY I'm gonna take drastic steps. Kick it to the curb. Don't mess with me. I'm the stair master. I've mastered the stairs. I wish I had a step right here. I'd step all over it.",
"DONKEY (os) Dragon! Donkey gasps and takes off running as the dragon roars again. Shrek manages to grab Donkey out of the way just as the dragon breathes fire.",
"DONKEY  No. Oh, no, No!  Oh, what large teeth you have. (thedragon growls) I mean white, sparkling teeth. I know you probably hear this all time from your food, but you must bleach, 'cause that is one dazzling smile you got there. Do I detect a hint of minty freshness? And you know what else? You're - - You're a girl dragon! Oh, sure! I mean, of course you're a girl dragon. You're just reeking of feminine beauty.What's the matter with you? You got something in your eye? Ohh. Oh. Oh. Man, I'd really love to stay, but you know, I'm, uh. I'm an asthmatic, and I don't know if it'd work out if you're gonna blow smoke rings. Shrek!",
"DONKEY Slow down. Slow down, baby, please. I believe it's healthy to get to know someone over a long period of time. Just call me old- fashioned. (laughs worriedly) (we see him up close and from a distance as Shrek sneaks into the room) I don't want to rush into a physical relationship. I'm not emotionally ready for a commitment of, uh, this - - Magnitude really is the word I'm looking for. Magnitude- - Hey, that is unwanted physical contact. Hey, what are you doing? Okay, okay. Let's just back up a little and take this one step at a time. We really should get to know each other first as friends or pen pals. I'm on the road a lot, but I just love receiving cards - - I'd really love to stay, but I Don't do that! That's my tail! That's my personal tail. You're gonna tear it off. I don't give permission - - What are you gonna do with that? ",
"DONKEY Hi, Princess!",
"DONKEY I hope you heard that. She called me a noble steed. She think I'm a steed.",
"DONKEY Maybe it's a perk.",
"DONKEY Hmm? With Shrek? You think- - Wait. Wait. You think that Shrek is you true love?",
"DONKEY You think Shrek is your true love!",
"DONKEY Well, so much for noble steed.",
"DONKEY I'm right behind ya.",
"DONKEY Okay, so here's another question. Say there's a woman that digs you, right, but you don't really like her that way. How do you let her down real easy so her feelings aren't hurt, but you don't get burned to a crisp and eaten?",
"DONKEY You're gonna love it there, Princess. It's beautiful!"
"DONKEY I don't know. There are those who think little of him. (they laugh again) Fiona: Stop it. Stop it, both of you. You're just jealous you can never measure up to a great ruler like Lord Farquaad.",
"DONKEY Whoa! Time out, Shrek! Camp is starting to sound good.",
"DONKEY Shrek, we can do better than that. I don't think this is fit for a princess.",
"DONKEY You want me to read you a bedtime story? I will",
"DONKEY Shrek, What are you doing?",
"DONKEY Right. Yeah. Hey, can you tell my future from these stars?",
"DONKEY I know you're making this up.",
"DONKEY That ain't nothin' but a bunch of little dots.",
"DONKEY (heaves a big sigh) Hey, Shrek, what we gonna do when we get our swamp anyway?",
"DONKEY You know, when we're through rescuing the princess.",
"DONKEY You cut me deep, Shrek. You cut me real deep just now. You know what I think? I think this whole wall thing is just a way to keep somebody out.",
"DONKEY Are you hidin' something?",
"DONKEY Oh, this is another one of those onion things, isn't it?",
"DONKEY Why don't you want to talk about it?",
"DONKEY Why are you blocking?",
"DONKEY Oh, yes, you are.",
"DONKEY Who you trying to keep out?",
"DONKEY (pause) Oh, now we're gettin' somewhere. (grins) At this point Fiona pulls the 'door' away from the entrance to the cave and peaks out. Neither of the guys see her.",
"DONKEY What's your problem? What you got against the whole world anyway?",
"DONKEY You know what? When we met, I didn't think you was just a big, stupid, ugly ogre.",
"DONKEY So, uh, are there any donkeys up there?",
"DONKEY Okay, okay, I see it now. The big shiny one, right there. That one there?",
"DONKEY (quietly) Mmm, yeah, you know I like it like that. Come on, baby. I said I like it.",
"DONKEY Huh? What?",
"DONKEY What?",
"DONKEY Oh, good morning, Princess!",
"DONKEY Shrek!. Well, it's no way to behave in front of a princess",
"DONKEY She's as nasty as you are.",
"DONKEY (walking up) Why? What's wrong?",
"DONKEY Shrek's hurt. Shrek's hurt? Oh, no, Shrek's gonna die.",
"DONKEY You can't do this to me, Shrek. I'm too young for you to die. Keep you legs elevated. Turn your head and cough. Does anyone know the Heimlich?",
"DONKEY Blue flower, red thorns. Okay, I'm on it. Blue flower, red thorns.",
"DONKEY Don't die Shrek. If you see a long tunnel, stay away from the light!",
"DONKEY Oh, yeah. Right. Blue flower, red thorns.",
"DONKEY Blue flower, red thorns. Blue flower, red thorns. Blue flower, red thorns. This would be so much easier if I wasn't color-blind! Blue flower, red thorns.",
"DONKEY Hold on, Shrek! I'm comin'! (rips a flower off a nearby bush that just happens to be a blue flower with red thorns) THE FOREST PATH ",
"DONKEY Look, if you wanted to be alone, all you had to do was ask. Okay?",
"DONKEY Hey, what's that? (nervous chuckle) That's...is that blood?",
"DONKEY Yeah, I know. You know, Shrek thinks Lord Farquaad's compensating for something, which I think means he has a really...(Shrek steps on his hoof) Ow!",
"DONKEY What are you talking about? I'm fine.",
"DONKEY I didn't want to say nothin', but I got this twinge in my neck, and when I turn my head like this, look, (turns his neck in a very sharp way until his head is completely sideways) Ow! See?",
"DONKEY Hey, where you goin'? Oh, man, I can't feel my toes! (looks down and yelps) I don't have any toes! I think I need a hug.",
"DONKEY (chuckles) Man, isn't this romantic? Just look at that sunset.",
"DONKEY Wait a minute. I see what's goin' on here. You're afraid of the dark, aren't you?",
"DONKEY Don't feel bad, Princess. I used to be afraid of the dark, too, until - - Hey, no, wait. I'm still afraid of the dark.",
"DONKEY Ohh! Now I really see what's goin' on here.",
"DONKEY I don't even wanna hear it. Look, I'm an animal, and I got instincts. And I know you two were diggin' on each other. I could feel it.",
"DONKEY Oh, come on, Shrek. Wake up and smell the pheromones. Just go on in and tell her how you feel.",
"DONKEY An ogre?",
"DONKEY Hey, where you goin'?",
"DONKEY Princess? Princess Fiona? Princess, where are you? Princess?",
"DONKEY (CONT D) It's very spooky in here. I ain't playing no games",
"DONKEY No, help!",
"DONKEY Shrek! Shrek! Shrek!",
"DONKEY What did you do with the princess?",
"DONKEY Oh, my God! You ate the princess. (to her stomach) Can you hear me?",
"DONKEY (still aimed at her stomach) Listen, keep breathing! I'll get you out of there!",
"DONKEY Shrek! Shrek! Shrek!",
"DONKEY Princess? What happened to you? You're, uh, uh, uh, different.",
"DONKEY Well, yeah! Was it something you ate? 'Cause I told Shrek those rats was a bad idea. You are what you eat, I said. Now - -",
"DONKEY What do you mean? Look, I ain't never seen you like this before.",
"DONKEY Ah, that's beautiful. I didn't know you wrote poetry.",
"DONKEY All right, all right. Calm down. Look, it's not that bad. You're not that ugly. Well, I ain't gonna lie. You are ugly. But you only looklike this at night. Shrek's ugly",
"DONKEY Princess, how 'bout if you don't marry Farquaad?",
"DONKEY But, you know, um, you're kind of an orge, and Shrek - - well, you got a lot in common.",
"DONKEY You at least gotta tell Shrek the truth.",
"DONKEY What's the point of being able to talk if you gotta keep secrets?",
"DONKEY All right, all right. I won't tell him. But you should. (goes outside) I just know before this is over, I'm gonna need a whole lot of serious therapy. Look at my eye twitchin'.",
"DONKEY What'd I miss? What'd I miss? (spots the soldiers) (muffled) Who said that? Couldn't have been the donkey.",
"DONKEY Shrek, what are you doing? You're letting her get away.",
"DONKEY Shrek, there's something about her you don't know. Look, I talked to her last night, She's - -",
"DONKEY Shrek, I wanna go with you.",
"DONKEY But I thought",
"DONKEY I would think, of all people, you would recognize a wall when you see one.",
"DONKEY It is around your half. See that's your half, and this is my half.",
"DONKEY Yes, my half. I helped rescue the princess. I did half the work. I get half the booty. Now hand me that big old rock, the one that looks like your head.",
"DONKEY No, you back off.",
"DONKEY Our swamp.",
"DONKEY You let go.",
"DONKEY Smelly ogre.",
"DONKEY Hey, hey, come back here. I'm not through with you yet.",
"DONKEY Uh-uh. You know, with you it's always,  Well, guess what! Now it's my turn! So you just shut up and pay attention! You are mean to me. You insult me and you don't appreciate anything that I do! You're always pushing me around or pushing me away.",
"DONKEY Because that's what friends do! They forgive each other!",
"DONKEY Ohh! You're so wrapped up in layers, onion boy, you're afraid of your own feelings.",
"DONKEY There you are , doing it again just like you did to Fiona. All she ever do was like you, maybe even love you.",
"DONKEY She wasn't talkin' about you. She was talkin' about, uh, somebody else.",
"DONKEY Uh-uh, no way. I ain't saying anything. You don't wanna listen to me. Right? Right?.Hey, that's what friends are for, right? Friends.",
"DONKEY What are you asking me for? Why don't you just go ask her?",
"DONKEY Ha-ha-ha! Never fear, for where, there's a will, there's a way and I have a way. (whistles) Suddenly the dragon arrives overhead and flies low enough so they can climb on.",
"DONKEY I guess it's just my animal magnetism.",
"DONKEY All right, all right. Don't get all slobbery. No one likes a kiss ass. All right, hop on and hold on tight. I haven't had a chance to install the seat belts yet.",
"DONKEY (to Dragon) Go ahead, HAVE SOME FUN. If we need you, I'll whistle. How about that? (she nods and goes after the guards) Shrek, wait, wait! Wait a minute! You wanna do this right, don't you?",
"DONKEY There's a line you gotta wait for. The preacher's gonna say, Speak now or forever hold your peace. That's when you say, I object!",
"DONKEY Hey, wait. What are you doing? Listen to me! Look, you love this woman, don't you?",
"DONKEY You wanna hold her?,Please her?",
"DONKEY (singing James Brown style) Then you got to, got to try a little tenderness. (normal) The chicks love that romantic crap!",
"DONKEY We gotta check it out. The whole town's in there. Inside",
"DONKEY Mother Fletcher! He already said it.",
"DONKEY All right. Nobody move. I got a dragon here, and I'm not afraid to use it. (The dragon roars.) I'm a donkey on the edge!",
"DONKEY (CONT’D) Celebrity marriages. They never last, do they?Go ahead, Shrek.",
"DONKEY (chuckles) I was hoping this would be a happy ending.",
"DONKEY (as he's done singing and we fade to black) Oh, that's funny. Oh. Oh. I can't breathe. I can't breathe"

]

import torch
from transformers import GPT2LMHeadModel, GPT2Tokenizer
import PyPDF2
import os

# Carregando o modelo pré-treinado GPT
model_name = "gpt2"
tokenizer = GPT2Tokenizer.from_pretrained(model_name)
model = GPT2LMHeadModel.from_pretrained(model_name)

# Tokenizando os diálogos
tokenized_dialogs = [tokenizer.encode(dialog, return_tensors="pt") for dialog in dialogs]

# Configuração de Fine-tuning

optimizer = torch.optim.Adam(model.parameters(), lr=1e-5)
loss_fn = torch.nn.CrossEntropyLoss()

# Treinamento do modelo
epochs = 10
for epoch in range(epochs):
    for tokenized_dialog in tokenized_dialogs:
        optimizer.zero_grad()
       #outputs = model(**{"input_ids": tokenized_dialog})
        outputs = model(input_ids=torch.tensor(tokenized_dialog).unsqueeze(0))

        logits = outputs.logits
        #loss = loss_fn(logits.view(-1, logits.shape[-1]), tokenized_dialog.view(-1))
        loss = loss_fn(logits.view(-1, logits.shape[-1]), torch.tensor(tokenized_dialog).view(-1))

        loss.backward()
        print(epoch)
        optimizer.step()

# Caminho para salvar o modelo treinado
output_dir = "gpt2_finetuned_model"

# Cria o diretório se não existir
if not os.path.exists(output_dir):
    os.makedirs(output_dir)

# Salva o modelo e os parâmetros do otimizador
model.save_pretrained(output_dir)
tokenizer.save_pretrained(output_dir)
torch.save(optimizer.state_dict(), os.path.join(output_dir, "optimizer_state_dict.pth"))

# Salve o modelo treinado, se necessário
model.save_pretrained("gpt_dialog_model")
tokenizer.save_pretrained("gpt_dialog_model")